<include>
  <context name="public-phone">

    <extension name="unloop">
      <condition field="${unroll_loops}" expression="^true$"/>
      <condition field="${sip_looped_call}" expression="^true$">
        <action application="deflect" data="${destination_number}"/>
      </condition>
    </extension>

    <!--
        Tag anything pass thru here as an outside_call so you can make sure not
        to create any routing loops based on the conditions that it came from 
        the outside of the switch.  
    -->
    <extension name="outside_call" continue="true">
      <condition break="never">
        <action application="set" data="outside_call=true"/>
        <action application="set" data="src_type=PSTN"/>
      </condition>
    </extension>

    <!-- Try to get domain_name from the sip_req_params variable -->
    <extension name="set_domain" continue="true">
      <condition field="${domain_name}" expression="^$" break="never"/>
      <condition field="source" expression="mod_sofia" break="never"/>
      <condition field="${sip_req_params}" expression="domain_name=([A-Z-a-z0-9.]+)" break="never">
        <!-- We need to export this so the B-Leg will have it after transfer too. -->
        <action application="export" data="domain_name=$1"/>
        <anti-action application="export" data="domain_name=$${domain}"/>
      </condition>
    </extension>

    <extension name="public_did">
      <condition field="destination_number" expression="^([0-9]+)$">
        <action application="transfer" data="$1 XML routing"/>
      </condition>
    </extension>

  </context>
</include>
