
These instructions are for Debian/Lenny.


Here I am assuming you use sudo to gain root access.
(The program does too.)

* On all servers, install the program:

sudo aptitude install libjson-perl libnet-libidn-perl libauthen-sasl-perl libxml-writer-perl libwww-perl libyaml-perl libexpat-dev liblogger-syslog-perl libio-stringy-perl git-core libnet-ssleay-perl build-essential
sudo cpan EV
sudo cpan AnyEvent::XMPP
sudo cpan AnyEvent::Watchdog

sudo aptitude install git-core
mkdir -p ~/src && (cd ~/src && git clone git://github.com/stephanealnet/ccnq2.0.git)


* On the API server:
sudo cpan AnyEvent::HTTPD

* On the manager server:
  CouchDB 0.9.x or above is required
sudo aptitude install ncurses-dev
wget http://erlang.org/download/otp_src_R13B02-1.tar.gz
  (configure, make, sudo make install)

sudo aptitude install build-essential spidermonkey-bin libmozjs-dev libicu-dev libcurl4-openssl-dev
sudo adduser --gecos '' --disabled-password couchdb
wget http://www.apache.org/dist/couchdb/0.10.0/apache-couchdb-0.10.0.tar.gz
  (configure, make, sudo make install)
sudo chown couchdb /usr/local/var/*/couchdb

sudo cpan AnyEvent::CouchDB

* On the proxy servers:

# Install OpenSIPS (note: we provide "amd64"-type Debian packages only)
cd ~/src
wget http://opensource.sotelips.net/~stephane/osip-1.5.3-tls/opensips_1.5.3-0_amd64.deb
wget http://opensource.sotelips.net/~stephane/osip-1.5.3-tls/opensips-mysql-module_1.5.3-0_amd64.deb
sudo dpkg -i opensips_1.5.3-0_amd64.deb
sudo dpkg -i opensips-mysql-module_1.5.3-0_amd64.deb
# XXX -> our installer should do this
sudo sed -i -e 's/^RUN_OPENSIPS=no$/RUN_OPENSIPS=yes/' /etc/default/opensips

sudo cpan AnyEvent::DBI

sudo aptitude install mysql-server
# Also I do:
sudo aptitude --purge remove portmap
sudo aptitude install postfix

# Part of the syslog information (during upgrade.pl) are to run some MySQL commands to initialize the database.
# Typically these are equivalent to:
sudo mysql <<SQL
  CREATE DATABASE opensips;
  CONNECT opensips;
  CREATE USER opensips IDENTIFIED BY 'opensips';
  GRANT ALL ON opensips.* TO opensips;
SQL
sudo /bin/sh -c 'mysql opensips < /etc/opensips/opensips.sql'


* On the SBC servers:
  Install FreeSwitch
cd ~/src
wget http://opensource.sotelips.net/~stephane/fs-1.0.4/freeswitch_1.0.4-1_amd64.deb
wget http://opensource.sotelips.net/~stephane/fs-1.0.4/freeswitch-lang-en_1.0.4-1_amd64.deb
wget http://opensource.sotelips.net/~stephane/fs-1.0.4/freeswitch-lua_1.0.4-1_amd64.deb
wget http://opensource.sotelips.net/~stephane/fs-1.0.4/freeswitch-sounds-en-us-callie-8000_1.0.4-1_amd64.deb
wget http://opensource.sotelips.net/~stephane/fs-1.0.4/freeswitch-codec-passthru-g729_1.0.4-1_amd64.deb

sudo aptitude install unixodbc libasound2 libcurl3 libvorbis0a 

sudo dpkg -i freeswitch_1.0.4-1_amd64.deb
sudo dpkg -i freeswitch-lang-en_1.0.4-1_amd64.deb
sudo dpkg -i freeswitch-lua_1.0.4-1_amd64.deb
sudo dpkg -i freeswitch-sounds-en-us-callie-8000_1.0.4-1_amd64.deb
sudo dpkg -i freeswitch-codec-passthru-g729_1.0.4-1_amd64.deb



* Finally:

# Install /etc/ccn/cookie
sudo mkdir /etc/ccn
hexdump -C /dev/urandom | head -1 | md5sum | sudo tee /etc/ccn/cookie

sudo tail -f /var/log/syslog &

# Then, many times:
sudo $HOME/src/ccnq2.0/common/bin/upgrade.pl

Monitor syslog during the execution of the scripts.

* On upgrades:

cd ~/src/ccnq2.0
git pull
sudo $HOME/src/ccnq2.0/common/bin/upgrade.pl
